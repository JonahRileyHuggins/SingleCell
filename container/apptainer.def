Bootstrap: docker
From: python:3.12-slim

%files
    ### Modify line 6, columns 9:14 to local SingleCell directory
    ${PWD}/../. /SingleCell ### Change This Line
    #^changeme-->^^^^^^^^Don't Delete Me :'(

%post
 
    # Set shell and environment
    export DEBIAN_FRONTEND=noninteractive
    export SHELL=/bin/bash

    # Export variables for the build process
    export BLAS_LIBS=-lopenblas
    #export LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH

    # Update and install basic dependencies
    apt-get update && apt-get install -y --no-install-recommends \
        build-essential \
        ninja-build \
        curl \
        wget \
        libboost-all-dev \
        libopenblas-dev \
        gcc \
        g++ \
        git \
        gfortran \
        cmake \
        swig \
        pipx \
        libhdf5-dev \
        vim nano curl wget dos2unix \
    && apt-get clean && rm -rf /var/lib/apt/lists/*

    # Ensure owner permissions for /SingleCell
    chmod -R 777 /SingleCell
    chown -R root:root /SingleCell

    # Ubuntu 24.04 doesn't symlink python to python3 by default:
    ln -s /usr/bin/python3 /usr/bin/python

    cd /SingleCell
    find . -type f -name "*.sh" -exec dos2unix {} \; \
    && find . -type f -name "*.sh" -exec chmod +x {} \;

    # Install Python Dependencies
    chmod +x ./Install.sh
    ./Install.sh

%environment
    # Set up runtime environment variables
    export PMIX_MCA_psec=^munge
    export PATH=/root/.local/bin:$PATH
    export BLAS_LIBS=-lopenblas

    # Ensures the container is bound to the local instance of SingleCell for cross operation.
    export SINGULARITY_BINDPATH="./SingleCell:/SingleCell:rw"

%runscript
    # Default command for the container
    exec SingleCell "$@"

%startscript
    exec SingleCell --help
    exec "$@"

%help
    This container enables cross-platform installation of SingleCell tools.
    Concerns and questions should be posted directly on our project
    Repository page at TO BE FILLED IN LATER.
